(function(f,d,v,y){"use strict";let i=null,r=null,u=null,s=null,a=null,c=null;const F=[".mp4",".webm",".mov",".avi",".mkv",".flv",".wmv",".m4v",".gifv"],m=new Map;function l(e){if(!e)return!1;try{return F.some(function(n){return new URL(e).pathname.toLowerCase().endsWith(n)})}catch{return F.some(function(n){return e.toLowerCase().split("?")[0].endsWith(n)})}}function I(e){if(!e)return e;const n=m.get(e);if(n)return n;try{const t=new URL(e);if(t.hostname==="cdn.discordapp.com"&&(t.hostname="media.discordapp.net"),t.hostname.includes("media.discordapp.net")||t.hostname.includes("images-ext")){t.searchParams.set("format","jpeg");const o=t.toString();return m.set(e,o),o}}catch{}return e}function g(){const e=window.vendetta?.metro?.modules??window.modules;if(!e)return null;for(const n in e)try{const t=e[n]?.publicModule?.exports;if(!t)continue;const o=t.default;if(o?.$$typeof?.toString().includes("memo")&&o.type&&(o.type.displayName==="GIFFavButton"||o.type.name==="GIFFavButton"))return o;if(typeof t=="function"&&(t.displayName==="GIFFavButton"||t.name==="GIFFavButton"))return t}catch{}return null}function h(e){return e.isGIFV?e:{...e,isGIFV:!0,embedURI:e.embedURI||e.sourceURI||e.uri,videoURI:e.videoURI||e.uri,embedProviderName:e.embedProviderName||""}}function p(){return r=g(),r?(i=r.type,r.type=function(e){const n={...e};return n.source&&!n.source.isGIFV&&(n.source=h(n.source)),i(n)},r.type.displayName="GIFFavButton",!0):!1}function G(){const e=v.findByProps("addFavoriteGIF");e&&(s=y.before("addFavoriteGIF",e,function(n){const t=n[0];if(!t||typeof t!="object")return;const o=t.url||"",B=t.src||"";l(o)||l(B)?t.format=2:t.format===2&&(t.format=1)}))}function b(){const e=v.findByProps("useFavoriteGIFsMobile");e&&(c=e,a=e.useFavoriteGIFsMobile,e.useFavoriteGIFsMobile=function(...n){const t=a.apply(this,n);if(t?.favorites&&Array.isArray(t.favorites))for(const o of t.favorites)o&&(l(o.url)||l(o.src))&&(o.src=I(o.src||o.url));return t})}var w={onLoad:function(){if(p())d.logger.log("[FavouriteAnything] Patched GIFFavButton.");else{let e=0;const n=function(){p()?(d.logger.log("[FavouriteAnything] Patched GIFFavButton (after retry)."),u=null):e++<50?u=setTimeout(n,300):d.logger.error("[FavouriteAnything] GIFFavButton not found after retries.")};u=setTimeout(n,300)}G(),b()},onUnload:function(){u&&(clearTimeout(u),u=null),r&&i&&(r.type=i,i=null,r=null),s&&(s(),s=null),c&&a&&(c.useFavoriteGIFsMobile=a,a=null,c=null),m.clear()}};return f.default=w,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta,vendetta.metro,vendetta.patcher);
