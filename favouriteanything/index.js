(function(f,d,m,p){"use strict";let i=null,r=null,u=null,s=null,a=null,l=null;const v=[".mp4",".webm",".mov",".avi",".mkv",".flv",".wmv",".m4v",".gifv"];function c(e){if(!e)return!1;try{return v.some(function(t){return new URL(e).pathname.toLowerCase().endsWith(t)})}catch{return v.some(function(t){return e.toLowerCase().split("?")[0].endsWith(t)})}}function y(e){if(!e)return e;try{const t=new URL(e);if(t.hostname==="cdn.discordapp.com"&&(t.hostname="media.discordapp.net"),t.hostname.includes("media.discordapp.net")||t.hostname.includes("images-ext"))return t.searchParams.set("format","jpeg"),t.toString()}catch{}return e}function I(){const e=window.vendetta?.metro?.modules??window.modules;if(!e)return null;for(const t in e)try{const n=e[t]?.publicModule?.exports;if(!n)continue;const o=n.default;if(o?.$$typeof?.toString().includes("memo")&&o.type&&(o.type.displayName==="GIFFavButton"||o.type.name==="GIFFavButton"))return o;if(typeof n=="function"&&(n.displayName==="GIFFavButton"||n.name==="GIFFavButton"))return n}catch{}return null}function h(e){return e.isGIFV?e:{...e,isGIFV:!0,embedURI:e.embedURI||e.sourceURI||e.uri,videoURI:e.videoURI||e.uri,embedProviderName:e.embedProviderName||""}}function F(){return r=I(),r?(i=r.type,r.type=function(e){const t={...e};return t.source&&!t.source.isGIFV&&(t.source=h(t.source)),i(t)},r.type.displayName="GIFFavButton",!0):!1}function G(){const e=m.findByProps("addFavoriteGIF");e&&(s=p.before("addFavoriteGIF",e,function(t){const n=t[0];if(!n||typeof n!="object")return;const o=n.url||"",w=n.src||"";c(o)||c(w)?n.format=2:n.format===2&&(n.format=1)}))}function g(){const e=m.findByProps("useFavoriteGIFsMobile");e&&(l=e,a=e.useFavoriteGIFsMobile,e.useFavoriteGIFsMobile=function(...t){const n=a.apply(this,t);return n?.favorites&&Array.isArray(n.favorites)&&(n.favorites=n.favorites.map(function(o){return o&&(c(o.url)||c(o.src)?{...o,src:y(o.src||o.url)}:o)})),n})}var b={onLoad:function(){if(F())d.logger.log("[FavouriteAnything] Patched GIFFavButton.");else{let e=0;const t=function(){F()?(d.logger.log("[FavouriteAnything] Patched GIFFavButton (after retry)."),u=null):e++<50?u=setTimeout(t,300):d.logger.error("[FavouriteAnything] GIFFavButton not found after retries.")};u=setTimeout(t,300)}G(),g()},onUnload:function(){u&&(clearTimeout(u),u=null),r&&i&&(r.type=i,i=null,r=null),s&&(s(),s=null),l&&a&&(l.useFavoriteGIFsMobile=a,a=null,l=null)}};return f.default=b,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta,vendetta.metro,vendetta.patcher);
